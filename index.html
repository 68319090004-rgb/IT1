<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Water Pump - ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏î‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f3f7fb;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 350px;
            text-align: center;
        }

        .title {
            font-size: 24px;
            color: #007acc;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .status-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .moisture-value {
            font-size: 50px;
            font-weight: bold;
            color: #9b59b6;
            margin: 10px 0;
        }

        #pump-badge {
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            color: white;
            background-color: #ccc;
            transition: 0.5s;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-on { background-color: #2ecc71; color: white; }
        .btn-off { background-color: #e74c3c; color: white; }
        button:hover { opacity: 0.8; }

        .mode-section {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="title">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏î‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ üåø</div>

    <div class="status-card">
        <div>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô</div>
        <div class="moisture-value"><span id="moisture">--</span>%</div>
        <div id="pump-badge">
            ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="p-status">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
        </div>
    </div>

    <div class="mode-section">
        <p>‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: <strong id="mode-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</strong></p>
        <div class="btn-group">
            <button class="btn-on" onclick="setMode('auto')">‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
            <button class="btn-off" onclick="setMode('manual')">‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</button>
        </div>
    </div>

    <div id="manual-controls" style="margin-top: 15px; display: none;">
        <p>‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á:</p>
        <div class="btn-group">
            <button class="btn-on" onclick="controlPump(true)">‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏±‡πä‡∏°</button>
            <button class="btn-off" onclick="controlPump(false)">‡∏õ‡∏¥‡∏î‡∏õ‡∏±‡πä‡∏°</button>
        </div>
    </div>
</div>

<script>
    // 1. Firebase Configuration (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤)
    const firebaseConfig = {
        apiKey: "7kb2i7jREFjgYa4HsWEU4P4BtWv9PGi50l2JTh2c",
        authDomain: "it-1-b7d46.firebaseapp.com",
        databaseURL: "https://it-1-b7d46-default-rtdb.firebaseio.com",
        projectId: "it-1-b7d46",
        storageBucket: "it-1-b7d46.appspot.com",
        messagingSenderId: "525174733532",
        appId: "1:525174733532:web:9e3465c9531efaf8b998c7"
    };

    // 2. Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentMode = 'auto';

    // 3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô
    db.ref("moisture").on("value", (snapshot) => {
        const val = snapshot.val();
        document.getElementById("moisture").innerText = val !== null ? val : "--";
        
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î Auto ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏õ‡∏±‡πä‡∏°‡∏ó‡∏µ‡πà 40%
        if (currentMode === 'auto' && val !== null) {
            if (val < 40) {
                updatePumpStatus(true);
            } else {
                updatePumpStatus(false);
            }
        }
    });

    // 4. ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡πä‡∏° (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ Badge)
    db.ref("pumpStatus").on("value", (snapshot) => {
        const isRunning = snapshot.val();
        const statusText = document.getElementById("p-status");
        const statusBadge = document.getElementById("pump-badge");

        if (isRunning) {
            statusText.innerText = "‡∏õ‡∏±‡πâ‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô";
            statusBadge.style.backgroundColor = "#2e7d32"; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
        } else {
            statusText.innerText = "‡∏õ‡∏±‡πâ‡∏°‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô";
            statusBadge.style.backgroundColor = "#d32f2f"; // ‡πÅ‡∏î‡∏á
        }
    });

    // 5. ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    db.ref("mode").on("value", (snapshot) => {
        currentMode = snapshot.val() || 'auto';
        document.getElementById("mode-text").innerText = currentMode === 'auto' ? "‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (40%)" : "‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á (Manual)";
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î Manual ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î manual
        document.getElementById("manual-controls").style.display = currentMode === 'manual' ? "block" : "none";
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î
    function setMode(newMode) {
        db.ref("mode").set(newMode);
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏õ‡∏±‡πä‡∏° (Manual)
    function controlPump(status) {
        if (currentMode === 'manual') {
            updatePumpStatus(status);
        } else {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô");
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    function updatePumpStatus(status) {
        db.ref("/").update({ pumpStatus: status });
    }
</script>

</body>
</html>
